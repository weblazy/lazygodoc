# 乐观锁
与悲观锁相反，乐观锁总是假设最好的情况。其假定发生冲突的概率很低，先修改完共享资源后，再验证这段时间是否有冲突发生。若存在，则再确定是否要提交操作，放弃本次操作则根据不同场景决定是否要重试。乐观锁全程没有加锁，所以也称为无锁编程。乐观送可以提升程序的吞吐量，避免业务处理时间过长。乐观锁两种实现：版本号机制。每一张数据表带有version版本号。每修改一次便加1.提交跟新时，只有读取到的version和当前数据库version一致时，才会更新数据表。CAS机制。该操作需要3个值，需要读取数据的内存位置，比较的预期值，待写入的新值。假设我们在修改前获得了原值，其即为用于比较的预期值。当要去修改时，读取内存位置的数据，判断是否与预期值相符，相符则更新新值。不相符则一直重试以上操作，CAS是自旋的。
在表中设计一个版本字段 version，第一次读的时候，会获取 version 字段的取值。然后对数据进行更新或删除操作时，会执行UPDATE ... SET version=version+1 WHERE version=version。此时如果已经有事务对这条数据进行了更改，修改就不会成功。

作者：西瓜学习
链接：https://www.zhihu.com/question/66733477/answer/1567439188
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。